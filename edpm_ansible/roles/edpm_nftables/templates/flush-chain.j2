# Managed by edpm-ansible/edpm_nftables

{% set chains = namespace(chains=[]) %}
{%- for ruleset in edpm_nftables_rules %}
{%    set rule=ruleset['rule'] %}
{%    set chain_key = rule.get('chain', 'INPUT') ~ rule.get('table', 'filter') %}
{%    if chain_key not in chains.chains %}
{%      if 'extras' not in rule or rule['extras'].get('ensure', 'present') in ['enabled', 'present'] %}
flush chain inet {{ rule.get('table', 'filter') }} EDPM_{{ rule.get('chain', 'INPUT') }}
{%      endif %}
{%      set _ = chains.chains.append(chain_key) %}
{%    endif %}
{% endfor %}
